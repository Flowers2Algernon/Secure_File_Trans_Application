

import os
import joblib
import pandas as pd
from malware_scan.extract_pdf_features import extract_features_from_pdf

# Get the directory containing the current script (malware_detector.py)
BASE_DIR = os.path.dirname(os.path.abspath(__file__))
# Join the directory path with the filename
model_path = os.path.join(BASE_DIR, 'demo_xgb_model.pkl')
columns_path = os.path.join(BASE_DIR, 'demo_xgb_columns.pkl')
# Load the model using the full, calculated path
model = joblib.load(model_path)
columns = joblib.load(columns_path)


def scan_pdf(filepath):
    features = extract_features_from_pdf(filepath, columns)
    df = pd.DataFrame([features]).reindex(columns=columns, fill_value=0)
    prediction = model.predict(df)[0]
    proba = model.predict_proba(df)[0][1]  # probability of malicious
    return prediction, proba

